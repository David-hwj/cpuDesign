--que ge quan jia qi
LIBRARY ieee;
USE ieee.std_logic_1164.all; 
LIBRARY work;
ENTITY ALU IS 
	PORT
	(
		R1 :  IN  STD_LOGIC_VECTOR(3 DOWNTO 0);
		R2 :  IN  STD_LOGIC_VECTOR(3 DOWNTO 0);
		S :  IN  STD_LOGIC_VECTOR(3 DOWNTO 0);
		C :IN STD_LOGIC;
		A:OUT  STD_LOGIC_VECTOR(4 DOWNTO 0)
	);
END ALU;
ARCHITECTURE bdf_type OF ALU IS 
COMPONENT zhiling
	PORT(A0 : IN STD_LOGIC;
		 A1 : IN STD_LOGIC;
		 A2 : IN STD_LOGIC;
		 A3 : IN STD_LOGIC;
		 A4 : IN STD_LOGIC;
		 A5 : IN STD_LOGIC;
		 A6 : IN STD_LOGIC;
		 A7 : IN STD_LOGIC;
		 MOVA : OUT STD_LOGIC;
		 MOVB : OUT STD_LOGIC;
		 MOVC : OUT STD_LOGIC;
		 ADD : OUT STD_LOGIC;
		 SUB : OUT STD_LOGIC;
		 AND0 : OUT STD_LOGIC;
		 NOT0 : OUT STD_LOGIC;
		 SHR : OUT STD_LOGIC;
		 SHL : OUT STD_LOGIC;
		 JMP : OUT STD_LOGIC;
		 JZ : OUT STD_LOGIC;
		 JC : OUT STD_LOGIC;
		 IN0 : OUT STD_LOGIC;
		 OUT0 : OUT STD_LOGIC;
		 NOP : OUT STD_LOGIC;
		 HALT : OUT STD_LOGIC
	);
END COMPONENT;
COMPONENT quanjia
	PORT(X,Y,Z : IN STD_LOGIC;
		 S,C : OUT STD_LOGIC
	);
END COMPONENT;
SIGNAL	ADD0,SUB0,AND00,NOT00,SHL0,SHR0:STD_LOGIC;

BEGIN 



b2v_inst : zhiling
PORT MAP(A0 => S(0),
		 A1 => S(1),
		 A2 => S(2),
		 A3 => S(3),
		 A4 => R1(1),
		 A5 => R1(0),
		 A6 => R2(1),
		 A7 => R2(0),
		 ADD=>ADD0,
		 SUB=>SUB0,
		 AND0=>AND00,
		 NOT0=>NOT00,
		 SHL=>SHL0,
		 SHR=>SHR0);
	PROCESS(ADD0,SUB0,AND00,NOT00,SHL0,SHR0,A)
BEGIN
IF (ADD0='1') THEN
A<=R1+R2;
ELSIF (SUB0='1') THEN
IF (R1<R2) THEN
A<=R2-R1;A(4)<='1';
ELSE
A<=R1-R2;
END IF;
ELSIF (AND00='1')THEN
A(0)<=R1(0) AND R2(0);A(1)<=R1(1) AND R2(1);A(2)<=R1(2) AND R2(2);A(3)<=R1(3) AND R2(3);A(4)<='0';
ELSIF (NOT00='1')THEN
A(0)<=NOT R1(0);A(1)<=NOT R1(1);A(2)<=NOT R1(2);A(3)<=NOT R1(3);A(4)<='0';
ELSIF (SHL0='1')THEN
  FOR i IN  2 DOWNTO 0 LOOP
  A(i)<=R(I);
END LOOP;
A(4)<='0';A(3)<='0';
ELSIF (SHR0='1')THEN
  FOR i IN  3 DOWNTO 1 LOOP
  A(i)<=R(i);
END LOOP;
A(4)<='0';A(0)<='0';
ELSE
A<="00000";
S<=A;
END IF;
END PROCESS;
END bdf_type;